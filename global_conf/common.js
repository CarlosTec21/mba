"use strict";!function(e){function a(){NIApi.register("stat.init",function(){var a=0,i=e.Main.xmlManager.get("statistics","servers").childNodes;for(a=0;a<i.length;a++)i[a].tagName&&t(i[a]);var r=e.Main.xmlManager.get("statistics","events");if(r)for(r=r.children,a=0;a<r.length;a++)g[r[a].getAttribute("name")]={category:r[a].getAttribute("category"),action:r[a].getAttribute("action"),label:r[a].getAttribute("title")};else c=!0;var l=e.Main.xmlManager.get("statistics","pages");if(l)for(l=l.children,a=0;a<l.length;a++)s[l[a].getAttribute("name")]={url:l[a].getAttribute("url"),title:l[a].getAttribute("title")};else o=!0});var a=e.Main.xmlManager.get("statistics","needConsent"),i=e.Main.xmlManager.get("common-ui","configs","cookie"),r=i.enabled&&i.gdpr,l=a||r;!!l==!1&&NIApi.stat.init(),NIApi.register("stat.trackPage",function(e,a){return this.trackPage({name:e,variables:a}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackEvent",function(e,a){return this.trackEvent({name:e,variables:a}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackCustomPage",function(e,a,t){return this.trackCustomPage({url:e,title:a,variables:t}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackCustomEvent",function(e,a,t,i){return this.trackCustomEvent({category:e,action:a,label:t,variables:i}),Promise.resolve()}.bind(this))}function t(a){var t=u[a.tagName],i="modules/"+t+"/js/index.js";"undefined"==typeof t&&(t=a.tagName,i="js/"+t+"Tracker",e.addCustomTemplate("js","js/"+t+"Tracker.js","${template}html/js/modules/"+t+"Tracker.js")),e.require([i]).then(function(){n.push(new(e.Class[e.Utils.capitalize(t+"Tracker")])(a))})}function i(){for(var e=Array.prototype.slice.call(arguments),a=0;a<e.length;a++)if("undefined"!=typeof e[a])return e[a]}function r(e,a){for(var t in a)e=e.replace("${"+t+"}",a[t]);return e}var l="",n=[],o=!1,s={},c=!1,g={},u={GoogleAnalytics:"analytics",GoogleTag:"googleTag",Piwik:"piwik",WebTrends:"webtrends",Xiti:"xiti"},b={page:{page:{url:"page=${1}",title:"page ${1}"},"page-alt":{url:"page=${1}-${2}",title:"pages ${1} and ${2}"},thumbnails:{url:"thumbnails",title:"page list"},search:{url:"search",title:"search panel"},"search-alt":{url:"search=${1}",title:'search for "${1}"'},pdf:{url:"pdf",title:"pdf generation"},print:{url:"print",title:"print"},contents:{url:"contents",title:"contents"},welcomepage:{url:"welcomepage",title:"welcome page"},share:{url:"share",title:"sharing"},"share-email":{url:"share=email",title:"email sharing"},favorites:{url:"favorites",title:"favorites list"},sharedby:{url:"sharedby",title:"shared by someone list"}},event:{pdfDownload:{action:"pdfDownload-${1}",label:"pdf download",category:"download"},externalLink:{action:"externalLink",label:"external link to ${1}",category:"navigation"},videoPlay:{action:"videoPlay-${1}-${2}",label:"video play ${1} at ${2}",category:"enrichment"},videoPause:{action:"videoPause-${1}-${2}",label:"video pause ${1} at ${2}",category:"enrichment"},videoEnd:{action:"videoEnd-${1}",label:"video played ${1}",category:"enrichment"},shareMail:{action:"share-mail",label:"share by email",category:"share"},shareSocial:{action:"share-${1}",label:"share on ${1}",category:"share"},print:{action:"print-${1}",label:"print",category:"print"},bookmark:{action:"bookmark-${1}",label:"page ${1} bookmarked",category:"bookmark"},unbookmark:{action:"unbookmark-${1}",label:"page ${1} removed from bookmarks",category:"bookmark"},link:{action:"link-${1}-${2}",label:"enrichment click",category:"enrichment"},pageView:{action:"pageView-${1}",label:"page ${1} viewed",category:"navigation"},pageNext:{action:"pageNext-${1}",label:"next page of ${1}",category:"navigation"},pagePrev:{action:"pagePrev-${1}",label:"previous page of ${1}",category:"navigation"},lightboxOpen:{action:"lightboxOpen-${1}",label:"Opening lightbox ${1}",category:"lightbox"},lightboxClose:{action:"lightboxClose-${1}",label:"Closing lightbox ${1}",category:"lightbox"},zoomIn:{action:"zoomIn-${1}",label:"zoom in page ${1}",category:"navigation"},zoomOut:{action:"zoomOut-${1}",label:"zoom out page ${1}",category:"navigation"},fullScreenOn:{action:"fullScreenOn",label:"full screen activated",category:"navigation"},fullScreenOff:{action:"fullScreenOff",label:"full screen deactivated",category:"navigation"},menuOpen:{action:"menuOpen",label:"open the menu",category:"menu"},menuClose:{action:"menuClose",label:"close the menu",category:"menu"}}};a.prototype.trackPage=function(a){var t=s[a.name],c=b.page[a.name];if("undefined"!=typeof a.name&&(o!==!1||"undefined"!=typeof t)&&a.url!==l){"page"===a.name&&2===Object.keys(a.variables).length?c=b.page["page-alt"]:"zoom"===a.name&&2===Object.keys(a.variables).length&&(c=b.page["zoom-alt"]),t=t||{},a.variables=a.variables||{},a.url=i(t.url,a.url,c.url),a.url=location.pathname+location.search+"#"+a.url,a.title=i(t.title,a.title,c.title),a.url=r(a.url,a.variables),a.url=e.Utils.whitelistParameters(a.url),a.title=r(a.title,a.variables);for(var g=0;g<n.length;g++)n[g].trackPage(location.pathname,a.url,a.title);l=a.url}},a.prototype.trackEvent=function(e){var a=g[e.name],t=b.event[e.name];if("undefined"!=typeof e.name&&(c!==!1||"undefined"!=typeof a)){a=a||{},e.variables=e.variables||{},e.category=i(a.category,e.category,t.category),e.action=i(a.action,e.action,t.action),e.label=i(a.label,e.label,t.label),e.category=r(e.category,e.variables),e.action=r(e.action,e.variables),e.label=r(e.label,e.variables);var l=new CustomEvent("webpub-tracking",{detail:e});window.dispatchEvent(l);for(var o=0;o<n.length;o++)n[o].trackEvent(e.category,e.action,e.label,e.value)}},a.prototype.trackCustomPage=function(a){if(a.url!==l){e.Utils._assertString(a.url,"The page URL should be a string"),e.Utils._assertString(a.title,"The page title should be a string"),l=a.url,a.variables=a.variables||{},a.url=location.pathname+location.search+"#"+a.url,a.url=r(a.url,a.variables),a.url=e.Utils.whitelistParameters(a.url),a.title=r(a.title,a.variables);for(var t=0;t<n.length;t++)n[t].trackPage(location.pathname,a.url,a.title)}},a.prototype.trackCustomEvent=function(a){e.Utils._assertString(a.category,"The page URL should be a string"),e.Utils._assertString(a.action,"The page title should be a string"),e.Utils._assertString(a.label,"The page title should be a string"),a.variables=a.variables||{},a.category=r(a.category,a.variables),a.action=r(a.action,a.variables),a.label=r(a.label,a.variables);for(var t=0;t<n.length;t++)n[t].trackEvent(a.category,a.action,a.label,a.value)},e.Class.TrackerManager=a}(webpublicationNamespace);